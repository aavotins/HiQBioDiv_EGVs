<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Utilities | High-resolution ecogeographical variables for species distribution modelling describing Latvia, 2024</title>
  <meta name="description" content="<p>Description of the geodata used and the geoprocessing workflows employed to
create ecogeographical variables (EGVs) for species distribution modelling
describing Latvia, 2024.</p>" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Utilities | High-resolution ecogeographical variables for species distribution modelling describing Latvia, 2024" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>Description of the geodata used and the geoprocessing workflows employed to
create ecogeographical variables (EGVs) for species distribution modelling
describing Latvia, 2024.</p>" />
  <meta name="github-repo" content="aavotins/HiQBioDiv_EGVs" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Utilities | High-resolution ecogeographical variables for species distribution modelling describing Latvia, 2024" />
  
  <meta name="twitter:description" content="<p>Description of the geodata used and the geoprocessing workflows employed to
create ecogeographical variables (EGVs) for species distribution modelling
describing Latvia, 2024.</p>" />
  

<meta name="author" content="Andris Avotiņš" />


<meta name="date" content="2025-10-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Ch01.html"/>
<link rel="next" href="Ch03.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">HiQBioDiv EGVs</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-material"><i class="fa fa-check"></i>About this material</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="Ch01.html"><a href="Ch01.html"><i class="fa fa-check"></i><b>1</b> Terminology and acronyms</a></li>
<li class="chapter" data-level="2" data-path="Ch02.html"><a href="Ch02.html"><i class="fa fa-check"></i><b>2</b> Utilities</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Ch02.html"><a href="Ch02.html#Ch02.01"><i class="fa fa-check"></i><b>2.1</b> R package egvtools</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="Ch02.html"><a href="Ch02.html#Ch02.01.01"><i class="fa fa-check"></i><b>2.1.1</b> Reproduction only functions</a></li>
<li class="chapter" data-level="2.1.2" data-path="Ch02.html"><a href="Ch02.html#Ch02.01.02"><i class="fa fa-check"></i><b>2.1.2</b> General purpose functions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="Ch02.html"><a href="Ch02.html#Ch02.02"><i class="fa fa-check"></i><b>2.2</b> Other utility functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Ch03.html"><a href="Ch03.html"><i class="fa fa-check"></i><b>3</b> Templates and utilities</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Ch03.html"><a href="Ch03.html#Ch03.01"><i class="fa fa-check"></i><b>3.1</b> Vector data</a></li>
<li class="chapter" data-level="3.2" data-path="Ch03.html"><a href="Ch03.html#Ch03.02"><i class="fa fa-check"></i><b>3.2</b> Raster data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Ch04.html"><a href="Ch04.html"><i class="fa fa-check"></i><b>4</b> Raw geodata</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Ch04.html"><a href="Ch04.html#state-forest-services-state-forest-registry-ch04.01"><i class="fa fa-check"></i><b>4.1</b> State Forest Services State Forest Registry (Ch04.01)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Ch05.html"><a href="Ch05.html"><i class="fa fa-check"></i><b>5</b> Geodata products</a></li>
<li class="chapter" data-level="6" data-path="Ch06.html"><a href="Ch06.html"><i class="fa fa-check"></i><b>6</b> Ecogeographical variables</a></li>
<li class="chapter" data-level="7" data-path="Ch07.html"><a href="Ch07.html"><i class="fa fa-check"></i><b>7</b> Data accessibility</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">High-resolution ecogeographical variables for species distribution modelling describing Latvia, 2024</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Ch02" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Utilities<a href="Ch02.html#Ch02" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter provides a brief description of the utility functions used in this
material. Most of these functions are packaged in the R package {egvtools}, which
was created specifically for this work.</p>
<div id="Ch02.01" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> R package egvtools<a href="Ch02.html#Ch02.01" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>{egvtools} provides a coherent set of wrappers and utilities that facilitate the
reproducible and efficient creation of large-scale EGVs on real datasets. The
package relies on robust building blocks — {terra}, {sf}, {sfarrow}, {exactextractr}
and {whitebox} — and standardises input/output, naming conventions and multi-scale
zonal statistics, ensuring that the pipelines are repeatable across machines and
projects.</p>
<p>The package was developed for the project ‘HiQBioDiv: High-resolution
quantification of biodiversity for conservation and management’, which was
funded by the Latvian Council of Science (Ref. No. VPP-VARAM-DABA-2024/1-0002),
to simplify our work and to facilitate the reproduction of our results. Five of
the functions are strictly for replication, while others are useful for a wider
audience.</p>
<p>Package can be installed from <a href="https://github.com/aavotins/egvtools">GitHub</a> with:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="Ch02.html#cb2-1" tabindex="-1"></a><span class="co"># install.packages(&quot;pak&quot;)</span></span>
<span id="cb2-2"><a href="Ch02.html#cb2-2" tabindex="-1"></a>pak<span class="sc">::</span><span class="fu">pak</span>(<span class="st">&quot;aavotins/egvtools&quot;</span>)</span></code></pre></div>
</details>
<p><br>
<br></p>
<p>or obtained as a <a href="https://hub.docker.com/repository/docker/aavotins/hiqbiodiv-container/general">Docker container</a> with all the necessary system and software dependencies.</p>
<div id="Ch02.01.01" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Reproduction only functions<a href="Ch02.html#Ch02.01.01" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>These functions are small wrappers, that helps to recreate our
working environments - template files and their locations in the file tree.</p>
<p>These functions are:</p>
<ul>
<li><p><a href="https://aavotins.github.io/egvtools/reference/download_raster_templates.html"><code>download_raster_templates()</code></a> — fetch template rasters from Zenodo repository
and place them in user specified location on disk, or by default - the
one we used. By default this functions links
to <a href="https://zenodo.org/records/14497070">version 2.0.0</a> of the dataset;</p></li>
<li><p><a href="https://aavotins.github.io/egvtools/reference/download_vector_templates.html"><code>download_vector_templates()</code></a> - fetch template vector grids/points from Zenodo
repository and place them in user specified location on disk, or by default - the
one we used. By default this functions links
to <a href="https://zenodo.org/records/14277114">version 1.0.1</a> of the dataset.</p></li>
</ul>
</div>
<div id="Ch02.01.02" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> General purpose functions<a href="Ch02.html#Ch02.01.02" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Each of those functions are small workflows themselves, that can be combined
into larger workflows and used more widely, than for Latvia.</p>
<ul>
<li><p><a href="https://aavotins.github.io/egvtools/reference/tile_vector_grid.html"><code>tile_vector_grid()</code></a> — tile template (vector) grid for chunked processing. The function internally is linked to our file naming
convention. As long as it is maintained, function can be used to create tiled grid
from any {sfarrow} parquet grid file;</p></li>
<li><p><a href="https://aavotins.github.io/egvtools/reference/tiled_buffers.html"><code>tiled_buffers()</code></a> —
precompute buffered tiles for multiple radii around
points. The function internally is linked to our file naming
convention. As long as it is maintained, function can be used to create tiled
polygons with buffers around points from any {sfarrow} parquet grid file. There
are three buffering modes: <strong>dense</strong> (buffers the best-matching pts100*.parquet
(prefers pts100_sauzeme.parquet) for each tile by radii_dense (default: 500,
1250, 3000, 10000 m ensuring that every analysis grid cell has desired buffer.
Computationally heavy in the following workflows), <strong>sparse</strong> (uses a file to
radius mapping and is highly generalizable),
and <strong>specified</strong> (the same as sparse, but with one single
point file). <strong>In our workflows we used the sparse mode with default mapping</strong>;</p></li>
<li><p><a href="https://aavotins.github.io/egvtools/reference/create_backgrounds.html">create_backgrounds()</a> — a wrapper
around <code>terra::ifel()</code> to build consistent background rasters. This function better
guards coordinate reference system and how it is stored, while also guarding
spatial cover, resolution, coordinate reference system, exact pixel matching, etc.
Creation of layers with default background values is faster than recreating them
several times in workflows preparing EGVs;</p></li>
<li><p><a href="">polygon2input()</a> — rasterize polygons to input layers. Handles only polygon data,
other geometry types need to buffered. Rasterizes polygon/multipolygon sf data to
a raster aligned to a template GeoTIFF. Rasterization targets a raster::RasterLayer
built from the template (so grids normally match). Projection is optional
(project_mode). Missing values are counted only over valid template cells. User
may optionally restrict the result with a raster mask (restrict_to) using numeric
values or bracketed range strings (e.g., “(0,5]”, “[10,)”). Remaining NA cells
can be filled by covering with a background raster (background_raster) or a
constant (background_value). For large rasters, heavy steps (projection/mask/cover)
can stream to disk via terra_todisk=TRUE.</p></li>
<li><p><a href="https://aavotins.github.io/egvtools/reference/input2egv.html">input2egv()</a> — normalize/align
a fine-resolution input raster to a (coarser) EGV template, optionally cover missing values and/or fill gaps (IDW via Whitebox), and write the result to disk. Designed for large runs: fast gap counting (inside template footprint only), optional filling, tuned GDAL write options, and controlled terra memory/temp behavior.</p></li>
<li><p><a href="">downscale2egv()</a> — downscale coarse rasters to a template grid (CRS,
resolution, extent), masks to the template footprint, and optionally: (1) fills
NoData gaps using WhiteboxTools’ IDW-based fill_missing_data, and (2) applies
IDW smoothing to reduce blockiness from low-resolution inputs.</p></li>
<li><p><a href="https://aavotins.github.io/egvtools/reference/distance2egv.html">distance2egv()</a> — computes
Euclidean distance (in map units) from cells matching a set of class values in
an input raster to all cells of an EGV template grid, then writes a Float32
GeoTIFF aligned to the template. Designed to work with rasters produced
by <code>polygon2input()</code>.</p></li>
<li><p><a href="https://aavotins.github.io/egvtools/reference/landscape_function.html">landscape_function()</a> — computes a {landscapemetrics} metric (default “lsm_l_shdi”), optionally with extra lm_args,
that yields one value per zone and per input layer. Runs tile-by-tile (by
tile_field), writes per-tile rasters, merges to final per-layer GeoTIFF(s),
then performs gap analysis (NA count within the template footprint and optional
maximum gap width) and optional IDW gap filling via WhiteboxTools. Returns a
compact data.frame with per-layer stats and timing.</p></li>
<li><p><a href="https://aavotins.github.io/egvtools/reference/radius_function.html">radius_function()</a> — extracts
summary statistics from raster layers using buffered polygon zones of multiple
radii and rasterizes them onto a common template grid.</p></li>
</ul>
</div>
</div>
<div id="Ch02.02" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Other utility functions<a href="Ch02.html#Ch02.02" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Other handy functions repeatedly used, not included in {egvtools} are stored
in <code>UtilityFunctions.R</code> file, located next to <code>.Rproj</code> file.</p>
<ul>
<li><code>ensure_multipolygons()</code> - rather agressive function to
create <code>MULTIPOLYGON</code> geometries from <code>GEOMETRYCOLLECTION</code></li>
</ul>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="Ch02.html#cb3-1" tabindex="-1"></a>ensure_multipolygons <span class="ot">&lt;-</span> <span class="cf">function</span>(X) {</span>
<span id="cb3-2"><a href="Ch02.html#cb3-2" tabindex="-1"></a>  <span class="fu">library</span>(sf)</span>
<span id="cb3-3"><a href="Ch02.html#cb3-3" tabindex="-1"></a>  <span class="fu">library</span>(gdalUtilities)</span>
<span id="cb3-4"><a href="Ch02.html#cb3-4" tabindex="-1"></a>  </span>
<span id="cb3-5"><a href="Ch02.html#cb3-5" tabindex="-1"></a>  tmp1 <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.gpkg&quot;</span>)</span>
<span id="cb3-6"><a href="Ch02.html#cb3-6" tabindex="-1"></a>  tmp2 <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.gpkg&quot;</span>)</span>
<span id="cb3-7"><a href="Ch02.html#cb3-7" tabindex="-1"></a>  <span class="fu">st_write</span>(X, tmp1)</span>
<span id="cb3-8"><a href="Ch02.html#cb3-8" tabindex="-1"></a>  <span class="fu">ogr2ogr</span>(tmp1, tmp2, <span class="at">f =</span> <span class="st">&quot;GPKG&quot;</span>, <span class="at">nlt =</span> <span class="st">&quot;MULTIPOLYGON&quot;</span>)</span>
<span id="cb3-9"><a href="Ch02.html#cb3-9" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">st_read</span>(tmp2)</span>
<span id="cb3-10"><a href="Ch02.html#cb3-10" tabindex="-1"></a>  <span class="fu">st_sf</span>(<span class="fu">st_drop_geometry</span>(X), <span class="at">geom =</span> <span class="fu">st_geometry</span>(Y))</span>
<span id="cb3-11"><a href="Ch02.html#cb3-11" tabindex="-1"></a>}</span></code></pre></div>
</details>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Ch01.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Ch03.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/aavotins/HiQBioDiv_EGVs/edit/main/book/02-Utilities.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["HiQBioDiv-EGVs.pdf", "HiQBioDiv-EGVs.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
